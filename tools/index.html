<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Product Lifecycle Modeling</title>
<link rel="icon" type="image/x-icon" href="../img/logo/favicon-usa-ga.png" />

<!--
  // To do: Mask Georgia Outline - from embed.js
  // cropMap = true requires the folllowing 3:
  // http://leaflet-extras.github.io/leaflet-providers/leaflet-providers.js"></script>
  // /documentation/region/js/boundary-canvas.js
  // /documentation/region/js/georgia.js


  // stickybits
  // Also see: https://dollarshaveclub.github.io/stickybits/
  // But will probably look at embed.js to detect when button of section reaches bottom of map.

  Angshuman Guin
  Senior Research Engineer
  Transportation Systems Engineering
  Smart Cities
  https://ce.gatech.edu/people/faculty/1251/overview

  Technology-Enabled Smarter Safer Routes to School for the City of Milton, GA
  http://smartcities.ipat.gatech.edu/sites/default/files/CityOfMilton_SmarterSaferRoutesToSchool.pdf
-->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
crossorigin=""/>
 <!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
crossorigin=""></script>

<script src="../js/d3/d3.v5.min.js"></script>
<!--
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
-->

<script type="text/javascript" src="../js/common/showdown.min.js"></script>
<script type="text/javascript" src="../js/jquery/jquery-1.12.4.min.js"></script>

<!--script type="text/javascript" src="../js/jquery/zepto.min.js"></script--><!-- stop().animate() are needed -->

<link rel="stylesheet" href="../css/community.css" />

<script type="text/javascript" src="../js/common/common.js"></script>
<script type="text/javascript" src="../js/common/navigation.js"></script>
<link rel="stylesheet" href="../css/display.css" />

  <!-- https://github.com/ilyankou/Leaflet.IconMaterial -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="../css/leaflet/leaflet.icon-material.css" rel="stylesheet">
  <script src="../js/leaflet/leaflet.icon-material.js"></script>

  <style>
    body { font-size: 14px; }
    h1 { font-size: 28px; }
    #map { height: 600px; }
    aside, pre { display: none; }
    div#allLegends { position: relative; }
    div.legend { position: relative; width: 200px; float: left; }
    .padding-left {
      padding-left:70px;
    }
    .headerLogo {
      height:40px;
      margin:28px 10px 4px 50px
    }

    .topLinks {
        z-index: 99999;
        padding: 20px 20px 20px 50px;
        font-size: 18px;
    }
    .topLinks a {
        color: #777;
        text-decoration: underline;
    }
    @media (max-width: 800px) {
      .padding-left {
        padding-left:0px;
      }
    }
    .my-div-icon {
      width: 24px !important;
      height: 20px !important;
      background-color: red;
      position:relative;
    }
    .my-div-icon:after {
      position: absolute;
      /* content: " (" attr(href) ")"; */
      content: "1";
      color: #fff;
      font-size: 14px;
      font-weight: 400;
      line-height: 20px;
      text-align: center;
      left: 0;
      right: 0;
    }
    .litePanel {
      background-color: #fff;
      overflow:auto;
    }
    .padding {
      padding: 40px;
    }
  </style>
</head>
<body>

<div id="header"></div>
<div style="height:60px"></div>

<a name="map"></a>

<!-- 1. + 2. insert aside block + data -->
<aside class="myDataset">
group,lat,lon,index,address
BK,48.157630,11.648014,1800,lothringer
BK,48.141579,11.604729,100,sdakjh
BK,48.143640,11.603463,1800,dsfasfslk 3.
BK,48.157630,11.648014,1800,loithringer
BK,48.141579,11.604729,100,sdakjh
BK,48.143640,11.603463,1800,dsfasfslk 3.
BK,48.143827,11.602895,500, sadkfjalsfj
BK,48.143640,11.603463,,dsfasfslk 3.
BK,48.143827,11.602895,, sadkfjalsfj
BK,48.144099,11.602444,120, hansenstrasse 4A
</aside>

<aside class="d2">
group,lat,lon,value
KK,48.157630,11.648014,30
KK,48.141579,11.604729,1800
KK,48.143640,11.603463,200
</aside>

<aside class="Intermodal_Ports">
group,lat,lon,value,address,city,state,zip
Inman Rail Yard,33.795735,-84.439278,NS,1600 Marietta Rd NW,Atlanta,GA,30318
Savannah Yard,32.069578,-81.142174,CSX,3000 Tremont Ave,Savannah,GA,31405
James D. Mason ICTF,32.123934,-81.150914,NS,3 North Main St,Garden City,GA,31408
Fairburn Industry Yard,33.554907,-84.595026,CSX,6700 McLarin Rd,Fairburn,GA,30213
Whitaker Rail Yard,33.80944,-84.655451,NS,6000 Westside Rd,Austell,GA,30106
Chatham ICTF,32.125311,-81.151331,CSX,2 Main St,Garden City,GA,31408
Savannah,32.10035,-81.169963,NS,1 Charlie Gay Drive,Savannah,GA,31408
Cordele Intermodal Center,31.966779,-83.755101,Heart GA,2902 East 13th Ave.,Cordele,GA,31010
Port of Savannah Ocean Terminal,32.093702,-81.111692,"Ro/Ro, Breakbulk",55 N Lathrop Ave,Savannah,GA,31415
Port of Brunswick,31.125887,-81.541194,"Ro/Ro, Agri-Bulk",157 Penniman Cir,Brunswick,GA,31523
Port of Savannah,32.125,-81.151,Container,2 Main St,Savannah,GA,31407
Port of Brunswick Mayor's Point Terminal,31.143373,-81.494753,Breakbulk,1100 Bay Street,Brunswick,GA,31520
Port of Columbus,32.448734,-84.984038,Liquid Bulk,800 Lumpkin Blvd,Columbus,GA,31901
Port of Bainbridge,30.902867,-84.606259,Liquid/Dry Bulk,1321 Spring Creek Road,Bainbridge,GA,39817
</aside>

<!--
group,lat,lon,value
KI,48.157630,11.648014,Sepp
KI,48.141579,11.604729,Schorsch
KI,48.143640,11.603463,Hans
-->
  
  <style>
      .content {
          max-width: 1000px;
          margin: 0 auto;
          padding-left: 40px;
          padding-right: 40px;
          font-size: 15px;
          line-height: 1.5;
      }
      .contentTop {
          padding-top: 60px;
      }
      .leaflet-popup {
        bottom: 17px !important; 
        /* Need to move map down more when popup is near top.  Default is -7px. */
      }
      #floatingButtons {
        display:none;
        height:40px;
        width:100%;
        position:fixed;
        bottom:0;
        background-color:#777;
        z-index:9999;
      }
      #flexwrapper {
        padding-top: 40px;
      }
      #flexwrapper {
        display: flex;
        justify-content: space-between;
        position: relative;
      }
      #hublist {
        overflow: auto;
        width:54%;
        padding-right:40px
      }
      #mapHolder {
        width: 46%;
        /* Show box for testing scroll */
        /* border: 1px solid #ccc; */

        position: relative;
      }

      .mapHolderBottom {
        position: absolute;
        bottom: 0px;
        width: 100%;
      }
      .mapHolderFixed {
        position: fixed;
        top: 80px;
        bottom: auto;
        width: 46%;
        width: 440px;
        padding-rightX: 30px; /* since fix is relative to page */
      }
      
      .mapHolderCard {
        widthX:100%;
        margin-right: 80px;
      }
      #maptop {
        height: 30px;
        border-bottomX: 1px solid #999;
        background-color: #fff;
        position: relative;
        color: #555;
        font-size: 16px;
      }
      #map {
        height: 500px;
        rightX: 0;
        widthX: 100%;
        box-sizing: border-box;
      }
      
      .mapHolderFixed > .mapHolderCard {
        margin-right: 30px;
      }

      #sidecolumn {
        float: left;
        width: 150px;
      }
      #sidecolumnContent {
        padding: 24px;
        position: fixed;
        line-height: 30px;
      }
      #fullcolumn {
        overflow: auto;
        border-left: 1px solid #ddd;
      }
      #sidecolumnContent a {
        display:block;
        width: 100%;
      }
      #sidecolumnContent a.active {
        border-left: 4px solid blue;
        margin-left:-24px;
        padding-left:20px;
      }
      @media (max-width: 800px) {
        .content {
          padding-left: 20px;
          padding-right: 20px;
        }
        .padding {
          padding: 20px;
        }
        #sidecolumn {
          display: none;
        }
        #flexwrapper {
          display: block;
          box-sizing: border-box;
        }
        #hublist {
          width:auto;
          
        }
        .padding-left {
          padding-left: 30px;
        }
        #mapHolder {
          width: auto;
          margin-top: 70px;
          margin-left: 30px;
          margin-bottom: 30px;
        }
        .mapHolderInner {
          position: relative;
          width: auto;
        }
        .mapHolderCard {
          heightX:400px;
          margin-right: 30px;
          borderX: 0px solid #fff;
        }

        #hublist {
          margin-left: 30px;
          margin-right: 30px;
        }

        #floatingButtons {
          display:block;
        }
      }
    </style>

  



<div id="sidecolumn">
  <div id="sidecolumnContent" style="z-index:0">

    <b style="font-size: 12px">ABOUT</b><br>
    <a href="#intro" class="active">Intro</a>
    <a href="#objectives">Objectives</a>
    <a href="#data">Data Driven</a>
    <a href="#modeling">IO Modeling</a>
    <a href="#charts">Material Flow</a>
    <a href="#regional">Multi-County</a>
    <a href="#local">Processor Maps</a>
    <a href="#places">All the Places</a>
    <br>

    <b style="font-size: 12px">CODE</b><br>

    <a href="#projects">Code Starters</a>
    <a href="#partners">Partners</a>

  </div>
  &nbsp;
</div>

<div id="fullcolumn">

  <section id="intro" class="content contentTop padding">

      <h1 style="margin-bottom:0px" class="h1-home">Product Lifecycle Modeling</h1>
      <!-- Marketplace -->

      <!--
      We're integrating visulization tools and distributed datasets 
      -->
      Tools for  
      communities, builders and manufacturers to increase efficiency 
      while protecting the environment using  
      <a href="https://www.epa.gov/smm" style="white-space:nowrap">Sustainable Materials Management</a>.<br>

      <!--
      <br>
      We've assembled the following as starting points for participants in our 2020 sustainable community events.
      -->

      <style>
        .three {
          margin-left: -20px;
          margin-right: -30px;

        }
        .three div {
          width:33%;
          float:left;
          padding-left: 20px;
          padding-right: 20px;
          box-sizing: border-box;
        }
        @media (max-width: 700px) {
          .three div {
            width:100%;
            float:none;
            padding-right:40px;
          }
        }
      </style>

      <div class='three' style='overflow:auto;'>
        <div>
          <h2>What?</h2>
          Data visualization tools and maps for exploring state, regional and local input-output flow to create models for 
          community planning, B2B networking and environmental education.
        </div>
        <div>
          <h2>Why?</h2>
          To reap the economic, social and environmental benefits of turning waste streams into revenue streams 
          that lower the cost of material input during production.
        </div>
        <div>
          <h2>How?</h2>
          By combining local, regional and national datasets with new module development using the 
          US EPA's Environmentally-Extended <span style='white-space: nowrap;'>Input-Output</span> API.
        </div>
      </div>

      <div>
          <h2>When and Where?</h2>
          Georgia communities are participating in our Lifecycle App design challenge in May of 2020. 
          During the Summer of 2020, college interns will create modules using local data. 
          We'll launch new tools during the Sustainable Communities Hackathon in the Fall of 2020. 
          <a href="https://model.georgia.org/communities" target="_blank">Learn More and Register</a>.
      </div>

  </section>

  
  <section id="objectives" class="litePanel contentTop padding">
    <div class="content" style="font-size: 18px">
      <a href="https://www.epa.gov/smm/epa-sustainable-materials-management-program-strategic-plan-fiscal-years-2017-2022">
        <img src="../img/overview/smmstratplan.jpg" style="width:100%; max-width:200px; float:right; margin-left:30px"></a>

      <h2>Sustainable Materials Management Objectives</h2>
      <!-- US EPA's four primary SMM program objectives -->
      <ol>
      <li>Decrease the disposal rate, which includes source reduction, reuse, recycling and prevention;</li>
      <li>Reduce the environmental impacts of materials across their life cycle;</li>
      <li>Increase socio-economic benefits; and </li>
      <li>Increase the capacity of state and local governments, communities and key stakeholders to adopt and implement SMM policies, practices and incentives.</li>
      </ol>
    </div>
  </section>
  <div style="clear:both"></div>

  <section id="data"><br><br>
  <div id="flexwrapper">

        <div id="hublist" class="padding-left">

          <h1 style="font-size: 28px">Data Driven Decision Making</h1>
          <h1 style="font-size: 18px; margin-bottom:0px; font-weight: 600">Smart & Sustainable Movement of Goods & Services</h1>
          <br><br>

          <!--
          <h1 style="margin-bottom:0px">Sustainable Movement of Goods & Services</h1>
          -->
          <!-- Smart & Mobile -->

          <!--
          <h3 style="margin-top:0px; margin-bottom:20px; font-size: 1.24em;">Smart Georgia - Data Driven Decision Making</h3>
          -->
          <!--Opportunities for Waze integration:<br><br>-->

          <div id="detaillist"></div>
          <div id="narrowlist" style="display:none"></div>
        </div>

      <a name="gomap"></a>
      <div id="mapHolder">
        <div class="mapHolderInner">
          <div class="mapHolderCard card">
            <div id="maptop">
              <div style="position:absolute; left:0; padding:4px 4px 4px 10px">
                Connected Communities
              </div>
            </div>

            <div style="clear:both">  
              <div id="map"></div>
            </div>

            
          </div>
        </div>
      </div>
      <div id="allLegends"></div>
  </div>
   </section>

  <div class="content padding">
      To add and update listings, download the <a href="map.csv">map.csv</a> file and edit within a spreadsheet.  
      Copy using a text editor and click the pencil icon <a href="https://github.com/modelearth/community/blob/master/map/map.csv">here</a> to paste into GitHub for review. 
      <span style="white-space: nowrap;">Or you can fork</span> the <a href="https://github.com/modelearth/community">GitHub Repo</a> and commit using <a href="https://desktop.github.com/">GitHub Desktop</a>.<br><br><br>
  </div>

  <div id="disqus_thread"></div>


  <section id="modeling" class="litePanel contentTop padding">
    <div class="content">
      <h1>Statewide Input-Output Modeling</h1>

      <a href="../samples/dataset/">module example</a>

      <img src="../img/overview/heatmap.png" style="width:100%">
    </div>
  </section>


  <section id="charts" class="contentTop padding">
    <div class="content">

      <h1>Sankey Chart of Material Flow</h1>

      <img src="../img/overview/flow.png" style="width:100%">

      <!--
      Source:
      https://www.kenflerlage.com/2018/04/sankey-template.html
      -->

    </div>
  </section>

  <div style="clear:both"></div>

  <section id="regional" class="contentTop padding">
    <div class="content">
      <div id="readmeDiv"></div><br>

      <iframe class="block-map-directory cf" id="map_directory" src="../samples/maps/counties/counties.html" style="width:100%;height:500px"></iframe>
    </div>
  </section>


  <section id="local" class="padding">
    <div class="content">
      <h1 style="margin-bottom:0px">Recycling Processors (B2B)</h1>

      <iframe class="block-map-directory cf" id="map_directory" src="https://data.georgia.org/site/widget.html#processors" style="width:100%;height:500px"></iframe>
    
      <div style="margin-top:18px">
        <a href="https://data.georgia.org/#recycling">Additional Datasets</a> - Landfills, Inert Waste, Transfer Stations
      </div>
    </div>
  </section>


  <section id="places" class="litePanel contentTop padding">
    <div class="content">
      <img src="../img/overview/places-us.gif" style="width:100%; max-width:300px; float:right">
      <h1>All The Places API</h1>

      Data will be harvested from existing websites and databases using the techniques developed for 
      <a href="https://github.com/alltheplaces/alltheplaces">All The Places</a>. 
      Over 450 spiders and scrapers pull data nightly from sites that post their 
      locations online. Material input-output requests can be shared using CSV files, HTML posts and API feeds.<br><br>

      <b>Example:</b> Your construction contract has a requirement to use 50% reclaimed lumber. 
      Add a link documenting how much lumber you need and when you need it.  Groups like 
      the <a href="https://www.lifecyclebuildingcenter.org/">Lifecycle Building Center</a> retrieve lumber after film productions and can 
      watch for taredown dates that fit your schedule.
      <br><br>
    </div>
  </section>


  <section id="projects" class="litePanel contentTop padding">
    <div class="content">
      <div id="projectsDiv" class="rootdoc"></div>
    </div>
  </section>


  
  <style>
    #footerBox {
      padding-top:20px;
      padding-bottom:20px;
    }
    @media (max-width: 700px) {
      #footerBox {
        padding-left:40px; 
      }
    }
  </style>
  <div id="footerBox" class="padding" style="clear:both; background: #eee; z-index: 2000; overflow: auto">
    <div class="content">
      <div id="partners" style="float:left; margin-right:40px">
        <h2>Partners</h2>

        <img src="../img/logo/epa.png" style="width:100px; float:left; margin-right: 20px">
        <img src="../img/logo/georgia.png" style="width:120px; float:left; margin-top: -4px">
      </div>

      <div style="float:left">
        <h2>Get Involved</h2>

        <a href="https://model.georgia.org/communities/">Register</a> to to participate in our 2020 events and internships.<br><br>

        <a href="https://GitHub.com/modelearth/community/">Edit on GitHub</a> - Contribute to our code and datasets.<br><br>

        <a href="https://waze.com/carpool" target="waze_carpool">Waze Carpool</a> - Find carpool riders and drivers near you.<br><br>
        <br><br>
      </div>
    </div>
  </div>

</div><!-- /#fullcolumn -->



    
    <style>
      .sectionMargin {
        margin:0 50px 0 90px;
      }
      @media (max-width: 700px) {
        .sectionMargin {
          margin-left: 30px;
        }
        #hublist {
          padding-left: 0px;
        }
      }


      .footerButton {
        font-size: 12pt;
        padding: 4px 8px 4px 8px;
        margin:5px;
        border-radius: 14px;
        border-radius: 4px;
        min-height: 20px;
        height: 20px;
        background-color: #348ec0;
        color: #fff;
        text-decoration: none !important;
        text-align: center;
        min-width: 80px;
        displayX: block;
        float:left;
      }
      .footerButton:hover {
        color:#fff;
        background: blue;
      }
    </style>



  <div id="floatingButtons">
    <div style="padding-right:10px;float:right">
      <a href="#gomap" class="footerButton">Map</a>
      <a href="#top" class="footerButton">Intro</a>
      <!--
      <a href="#items" class="footerButton">Items</a>
      -->
    </div>
  </div>

  



<script>
  // Set your own Mapbox access token below.
  // Restrict which domains your token is loaded through.
  // https://blog.mapbox.com/url-restrictions-for-access-tokens-5f7f7eb90092

  var mbAttrX = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
      '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
      mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZWUyZGV2IiwiYSI6ImNqaWdsMXJvdTE4azIzcXFscTB1Nmcwcm4ifQ.hECfwyQtM7RtkBtydKpc5g';
  var mbAttr = '',
      mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZWUyZGV2IiwiYSI6ImNqaWdsMXJvdTE4azIzcXFscTB1Nmcwcm4ifQ.hECfwyQtM7RtkBtydKpc5g';

  var grayscale = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
      satellite = L.tileLayer(mbUrl, {id: 'mapbox.satellite',   attribution: mbAttr}),
      streets = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});

  //var layerGroups = {};
  var dataParameters = []; 
  var dp = {};
  var layerControl = false;

  //////////////////////////////////////////////////////////////////
  // Usage:
  //
  // data: csv file with 
  //  lon, lat for position
  //  one numerical or categorical attribute to be visualized
  //  + (optional) one attribute calles "address" to be shown in tooltip
  // 
  // 1. set class of aside element above to match the name of the data
  // 2. insert data into aside element
  // 3. specify the following dp (data parameters) 
  // 4. initialize map center with [lat, lon]
  // 5. Load Layers Asynchronously
  //
  // options for scales:
  // "scaleThreshold", "scaleOrdinal", "scaleOrdinal" or "scaleQuantile"
  //////////////////////////////////////////////////////////////////

  /////////// LOAD FROM HTML ///////////

  // ------> for more html datasets, copy FROM here
  // dataset 1
  
  dp = {
    selector: "aside.myDataset",
    delimiter: ",",
    numColumns: ["lat","lon","index","address"],
    valueColumn: "index",
    scaleType: "scaleThreshold",
  }
  dp.name = dp.selector.split(".").pop(); // name: myDataset
  // specify end
  dp.data = readData(dp.selector, dp.delimiter, dp.numColumns, dp.valueColumn);
  dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);
  dp.group = L.layerGroup();
  //dataParameters.push(dp); // Adds to layer menu - Uncomment to reactivate
  //addIcons(dp);
  //addLegend(dp.scale, dp.scaleType, dp.name);
  
  // ------> for more html datasets, copy TO here

  // dataset 2 - Example of scaled with color-code for 7 ranges
  /*
  dp = {
    selector: "aside.d2",
    delimiter: ",",
    numColumns: ["lat","lon","value"],
    valueColumn: "value",
    scaleType: "scaleQuantize",
  }
  dp.name = dp.selector.split(".").pop(); // name: d2
  dp.data = readData(dp.selector, dp.delimiter, dp.numColumns, dp.valueColumn);
  dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);
  dp.group = L.layerGroup();
  dataParameters.push(dp);
  addIcons(dp);
  addLegend(dp.scale, dp.scaleType, dp.name);
  */

  // INTERMODAL PORTS
  dp = {
    selector: "aside.Intermodal_Ports",
    delimiter: ",",
    numColumns: ["lat","lon"],
    valueColumn: "value",
    scaleType: "scaleOrdinal",
    //scaleType: "scaleQuantile",
  }
  //dp.name = dp.selector.split(".").pop(); // name: Intermodal_Ports
  dp.name = "Intermodal Ports"
  dp.data = readData(dp.selector, dp.delimiter, dp.numColumns, dp.valueColumn);
  dp.color = '#555'; // Alternative to scale
  dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);

  dp.group = L.layerGroup();
  //dp.iconName = 'device_hub';
  dp.iconName = 'language';
  dataParameters.push(dp);
  addIcons(dp);
  //addIcons(dp);
  // Reactivate once colors differ
  //addLegend(dp.scale, dp.scaleType, dp.name);



  function loadFromCSV() {
    // 5. Load Layers Asynchronously
    //var dataset = "../community/map/zip/basic/places.csv";

    // Change below
    // latColumn: "lat",
    //      lonColumn: "lon",
    //var dataset = "https://datascape.github.io/community/map/zip/basic/places.csv";

    var dataset = "map.csv";

    d3.csv(dataset).then(function(data) {
        dp = {
          numColumns: ["zip","lat","lon"],
          valueColumn: "name",
          latColumn: "lat",
          lonColumn: "lon",
          //scaleType: "scaleQuantile",
          scaleType: "scaleOrdinal",
        }
        dp.name = "Smart Data Projects"; // Must match "map.addLayer(overlays" below.
        dp.data = readCsvData(data, dp.numColumns, dp.valueColumn);
        dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);
        dp.group = L.layerGroup();
        dp.iconName = 'star';
        dataParameters.push(dp);
        overlays[dp.name] = dp.group; // Allows for use of dp.name with removeLayer and addLayer

        if(layerControl === false) {
          layerControl = L.control.layers(baseLayers, overlays).addTo(map);
        }
        layerControl.addOverlay(dp.group, dp.name); // Appends to existing layers
        addIcons(dp);
        //addLegend(dp.scale, dp.scaleType, dp.name); // Reactivate

        showList(dp);

        // All layers reside in this object:
        console.log("dataParameters:");
        console.log(dataParameters);

        // Remove from control and background.
        //layerControl.removeLayer(grayscale);
        //map.removeLayer(grayscale);

        
        //layerControl.removeLayer(overlays["myDataset"]); // Remove from control 
        //map.removeLayer(overlays["myDataset"]); // Remove from map

        map.addLayer(overlays["Smart Data Projects"]);
    })
    .catch(function(error){ 
         alert("Data loading error: " + error)
    })
  }
  loadFromCSV();


  /////////// MAP SETTINGS ///////////
  
  // 33.863516,-84.368775
  var mapCenter = [32.90,-83.35]; // [latitude, longitude]

  var map = L.map('map', {
    center: mapCenter,
    scrollWheelZoom: false,
    zoom: 7
  });
  
  // Add above to include overlays WITHOUT showing in legend:
  // layers: [dataParameters[0].group]

  // If added both baseLayers and overlays WITHOUT showing in legend:
  // layers: [grayscale, dataParameters[0].group]

  // Avoid layers: [grayscale] above 
  // - two sets of tiles would be loaded when upper baseLayer is changed using radio buttons.
  

  var baseLayers = {
    "Grayscale": grayscale,
    "Streets": streets,
    "Satellite": satellite
  };

  var overlays = {};
  dataParameters.forEach(function(ele) {
    overlays[ele.name] = ele.group; // Add to layer menu
  })
  if(layerControl === false) {
    layerControl = L.control.layers(baseLayers, overlays).addTo(map);
    baseLayers["Grayscale"].addTo(map); // Set the initial baselayer.
  }


    // Sample of single icon - place in addIcons function
    // Create a semi-transparent bus icon
    var busIcon = L.IconMaterial.icon({
      icon: 'local_shipping',            // Name of Material icon
      iconColor: '#fff',              // Material icon color (could be rgba, hex, html name...)
      markerColor: 'rgba(255,0,0,0.5)',  // Marker fill color
      outlineColor: 'rgba(255,0,0,0.5)',            // Marker outline color
      outlineWidth: 1,                   // Marker outline width 
    })
    
    // Attach the icon to the marker and add to the map
    //L.marker([33.74,-84.38], {icon: busIcon}).addTo(map)
    
    // Set .my-div-icon styles in CSS
    //var myIcon = L.divIcon({className: 'my-div-icon'});
    //L.marker([32.90,-83.83], {icon: myIcon}).addTo(map);


  /////////////////////////////////////////
  // helper functions
  /////////////////////////////////////////
  function addLegend(scale, scaleType, title) {
    var svg = d3.select("#allLegends")
      .append("div")
        .attr("class", "legend "  + title)
      .append("svg")
        .style("width", 200);
        // .styleX("height", 300)

    svg.append("g")
        .attr("class", "legend")
        .attr("transform", "translate(20,20)");

    var legend = d3.legendColor()
      .labelFormat(d3.format(".2f"))
      .title(title);
  
    if (scaleType === "scaleThreshold") {
      legend = legend.labels(d3.legendHelpers.thresholdLabels);
    }

    legend.scale(scale);  

    svg.select("g.legend")
      .call(legend);
  }
  
  function hex2rgb(hex) {
    // long version
    r = hex.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);
    if (r) {
      return r.slice(1,4).map(function(x) { return parseInt(x, 16); });
    }
    // short version
    r = hex.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);
    if (r) {
      return r.slice(1,4).map(function(x) { return 0x11 * parseInt(x, 16); });
    }
    return null;
  }

  //alert(hex2rgb("#0033ff")); // a pretty blue;

  function addIcons(dp) {
    var circle;
    var iconColor, iconColorRGB, iconName;
    var colorScale = dp.scale;
    dp.data.forEach(function(element) {
      iconColor = colorScale(element[dp.valueColumn]);
      if (dp.color) { 
        iconColor = dp.color;
      }
      // How to make element always lowercase?
      console.log("element " + element + " iconColor: " + iconColor)
      if (typeof dp.latColumn == "undefined") {
        dp.latColumn = "lat";
      }
      if (typeof dp.lonColumn == "undefined") {
        dp.lonColumn = "lon";
      }
      iconColorRGB = hex2rgb(iconColor);
      iconName = dp.iconName;
      var busIcon = L.IconMaterial.icon({
        icon: iconName,            // Name of Material icon - star
        iconColor: '#fff',         // Material icon color (could be rgba, hex, html name...)
        markerColor: 'rgba(' + iconColorRGB + ',0.7)',  // Marker fill color
        outlineColor: 'rgba(' + iconColorRGB + ',0.7)', // Marker outline color
        outlineWidth: 1,                   // Marker outline width 
      })
    
      // Attach the icon to the marker and add to the map
      //L.marker([element[dp.latColumn], element[dp.lonColumn]], {icon: busIcon}).addTo(map)
      circle = L.marker([element[dp.latColumn], element[dp.lonColumn]], {icon: busIcon}).addTo(dp.group);


      var output = "<b>" + element[dp.valueColumn] + "</b><br>" + element.address + "<br>" + element.city + " " + element.state + " " + element.zip + "<br>";
      if (element.phone || element.phone_afterhours) {
        output += element.phone + " " + element.phone_afterhours + "<br>";
      }

      if (element.schedule) {
        output += "Hours: " + element.schedule + "<br>";
      }
      if (element.website) {
        output += "<a href='" + element.website + "' target='_blank'>Website</a>";
      }
      if (element.website && element[dp.latColumn]) {
        output += " | ";
      }
      if (element[dp.latColumn]) {
          output += "<a href='https://www.waze.com/ul?ll=" + element[dp.latColumn] + "%2C" + element[dp.lonColumn] + "&navigate=yes&zoom=17'>Waze Directions</a><br>";
      }
      circle.bindPopup(output);
        // "<br>Latitude: " + element[dp.latColumn] + 

      //alert(output);
    });
  }

  function showList(dp) {

    var colorScale = dp.scale;
    dp.data.forEach(function(element) {


      var output = "<div style='width:15px;height:15px;margin-right:8px;margin-top:3px;background:" + colorScale(element[dp.valueColumn]) + ";float:left'></div><div style='overflow:auto'>"
      output += "<b style='font-size:16px;color:#333'>" + element[dp.valueColumn] + "</b><br>" + element.address + "<br>" + element.city + " " + element.state + " " + element.zip + "<br>";
      if (element.phone || element.phone_afterhours) {
       output += element.phone + " " + element.phone_afterhours + "<br>";
      }
      if (element.schedule) {
       output += "Hours: " + element.schedule + "<br>";
      }
      if (element.website) {
        output += "<a href='" + element.website + "' target='_blank'>Website</a><br>";
      }
      if (element.website && element[dp.latColumn]) {
        output += " | ";
      }
      if (element[dp.latColumn]) {
          output += "<a href='https://www.waze.com/ul?ll=" + element[dp.latColumn] + "%2C" + element[dp.lonColumn] + "&navigate=yes&zoom=17'>Waze Directions</a>";
      }
       output += "<br></div><div style='clear:both'></div>";

      $("#narrowlist").append(output);

      // Detail List with Descriptions
      output = "<div style='width:15px;height:15px;margin-right:8px;margin-top:3px;background:" + colorScale(element[dp.valueColumn]) + ";float:left'></div><div style='overflow:auto'>"
      output += "<b style='font-size:16px;color:#333'>" + element.title + "</b><br>";

      output += element.description + "<br>";

      /*
      output += "<b>" + element.name + "</b> " + element.address + ", " + element.city + " " + element.state + " " + element.zip + " ";
      if (element.phone || element.phone_afterhours) {
       output += element.phone + " " + element.phone_afterhours + "<br>";
      }
      if (element.schedule) {
       output += "Hours: " + element.schedule + "<br>";
      }
       if (element[dp.latColumn]) {
          output += " - <a href='https://www.waze.com/ul?ll=" + element[dp.latColumn] + "%2C" + element[dp.lonColumn] + "&navigate=yes&zoom=17'>Waze Directions</a><br>";
      }
      */

      if (element.website) {
        // Learn More:
        output += "<a href='" + element.website + "' style='display:block;margin-top:5px' target='_blank'>" + element.website.replace("https://","").replace("http://","").replace("www.","") + "</a><br>";
      }
      output += "</div><div style='clear:both'></div>";

      $("#detaillist").append(output);


    });
  }

  // Scales: http://d3indepth.com/scales/
  function getScale(data, scaleType, valueCol) {
    var scale;
    if (scaleType === "scaleThreshold") {
      var min = d3.min(data, function(d) { return d[valueCol]; });
      var max = d3.max(data, function(d) { return d[valueCol]; });
      var d = (max-min)/7;
      scale = d3.scaleThreshold()
        .domain([min+1*d,min+2*d,min+3*d,min+4*d,min+5*d,min+6*d])
        .range(['#ffffe0','#ffd59b','#ffa474','#f47461','#db4551','#b81b34','#8b0000']);
    } else if (scaleType === "scaleQuantize") {
      scale = d3.scaleQuantize()
        .domain(d3.extent(data, function(d) { return d[valueCol]; }))
        .range(['#ffffe0','#ffd59b','#ffa474','#f47461','#db4551','#b81b34','#8b0000']);
    } else if (scaleType === "scaleQuantile") {
      scale = d3.scaleQuantile()
        .domain(data.map(function(d) { return d[valueCol]; }).sort(function(a, b){return a-b}))
        .range(['#ffffe0','#ffd59b','#ffa474','#f47461','#db4551','#b81b34','#8b0000']);            
    } else if (scaleType === "scaleOrdinal") {
      scale = d3.scaleOrdinal()
        .domain(data.map(function(d) { return d[valueCol]; }))
        .range(d3.schemePaired);
    }
    return scale;
  }

  function readData(selector, delimiter, columnsNum, valueCol) {
    var psv = d3.dsvFormat(delimiter);
    var initialData = psv.parse(removeWhiteSpaces(d3.select(selector).text())); 
    _data = initialData.filter(function(e) { return e[valueCol].length !== 0; });
    console.log("Skipped: " + (initialData.length - _data.length) + " rows.");
    
    if (typeof columnsNum !== "undefined") {
      _data.forEach( function (row) {
        convertToNumber(row, columnsNum);
      });
    }
    //console.log(_data);
    return _data;
  }
  function readCsvData(_data, columnsNum, valueCol) {
    //console.log(_data);
    
    // 'for of' loop is more efficient than forEach. 
    // Also works on objects. You can call it like this 'for let d of Object.entries(data){ }'

    if (typeof columnsNum !== "undefined") {
      _data.forEach( function (row) {
        //row = removeWhiteSpaces(row);
        convertToNumber(row, columnsNum);
      });
    }
    console.log(_data);
    return _data;
  }
  function convertToNumber(d, _columnsNum) {
    for (var perm in d) {
      if (_columnsNum.indexOf(perm) > -1)
        if (Object.prototype.hasOwnProperty.call(d, perm)) {
          d[perm] = +d[perm];
        }
      }  
    return d;
  } 

function removeWhiteSpaces (str) {
  return str.replace(/^\s+|\s+$|\s+(?=\s)/g, "");
}



$('#sidecolumnContent a').click(function(event) {
    setTimeout(function(){ 

      var y = $(window).scrollTop();  //your current y position on the page
      $(window).scrollTop(y-50); // Adjust for fixed header.

    }, 10);
});



  function elementScrolled(elem) // scrolled into view
  {
    var docViewTop = $(window).scrollTop();
    var docViewBottom = docViewTop + $(window).height();
    var elemTop = $(elem).offset().top;
    return ((elemTop <= docViewBottom) && (elemTop >= docViewTop));
  }
  function bottomReached(elem) // bottom scrolled into view
  {
    var docViewTop = $(window).scrollTop();
    var docViewBottom = docViewTop + $(window).height();
    var hangover = 10; // Extend into the next section, so map remains visible.
    //var elemTop = $(elem).offset().top;
    var elemBottom = $(elem).offset().top + $(elem).height() + hangover - docViewBottom;
    //console.log('offset: ' + $(elem).offset().top + ' height:' + $(elem).height() + ' docViewBottom:' + docViewBottom + ' elemBottom: ' + elemBottom);
    //console.log('bottomReached elemBottom: ' + elemBottom);
    return (elemBottom < 0);
  }
  function topReached(elem) // top scrolled out view
  {
    var docViewTop = $(window).scrollTop();
    //var docViewBottom = docViewTop + $(window).height();
    var pretop = 80; // Extend into the next section, so map remains visible.
    //var elemTop = $(elem).offset().top;
    var elemTop = $(elem).offset().top - docViewTop - pretop;
    //console.log('offset: ' + $(elem).offset().top + ' height:' + $(elem).height() + ' docViewBottom:' + docViewBottom + ' elemBottom: ' + elemBottom);
    //console.log('topReached elemTop: ' + elemTop);
    return (elemTop < 0);
  }



// Cache selectors
var lastId,
 topMenu = $("#sidecolumnContent"),
 //alert($("#sidecolumnContent").height());
 //topMenuHeight = topMenu.height()+1,
 topMenuHeight = topMenu.outerHeight()+1,
 // All list items
 menuItems = topMenu.find("a"),
 // Anchors corresponding to menu items
 scrollItems = menuItems.map(function(){
   var item = $($(this).attr("href"));
    if (item.length) { return item; }
 });

// Bind click handler to menu items
// so we can get a fancy scroll animation
menuItems.click(function(e){
  /*
  var href = $(this).attr("href");
  console.log('Clicked ' + href);
  var offsetTop = href === "#" ? 0 : $(href).offset().top-topMenuHeight+1;
  $('html, body').stop().animate({
      scrollTop: offsetTop
  }, 850);
  e.preventDefault();
  */
});


var mapFixed = false;
$(window).scroll(function() {

  // This is where we use the function to detect if ".box2" is scrolled into view, and when it is add the class ".animated" to the <p> child element
  if (bottomReached('#hublist')) {
    if (mapFixed==true) { // Only unstick when crossing thresehold to minimize interaction with DOM.
      //console.log('bottom Visible');
      $('.mapHolderInner').removeClass('mapHolderFixed');
      $('.mapHolderInner').addClass('mapHolderBottom');
      // Needs to be at bottom of dev
      mapFixed = false;
    }
  } else if(topReached('#hublist')) {
    if (mapFixed==false) {
      $('.mapHolderInner').addClass('mapHolderFixed');
      $('.mapHolderInner').removeClass('mapHolderBottom');
      //alert("fixed position")
      mapFixed = true;
    }
  } else if(!topReached('#hublist') && mapFixed == true) { // Not top reached (scrolling down)
    $('.mapHolderInner').removeClass('mapHolderFixed');
    mapFixed = false;
  }


  // Get container scroll position
   var fromTop = $(this).scrollTop()+topMenuHeight;
   
   // Get id of current scroll item
   var cur = scrollItems.map(function(){
     if ($(this).offset().top < fromTop)
       return this;
   });
   // Get the id of the current element
   cur = cur[cur.length-1];
   var id = cur && cur.length ? cur[0].id : "";
   
   if (lastId !== id) {
      console.log("CURRENT ID: " + id);
      lastId = id;
      // Set/remove active class

      menuItems.removeClass("active");
      menuItems.filter("[href='#"+id+"']").addClass("active");
      menuItems
         .parent().removeClass("active")
         .end().filter("[href='#"+id+"']").parent().addClass("active");
   }
   // 
});

</script>

<script>
  loadMarkupPage("README.md", "readmeDiv", "_parent");
  loadMarkupPage("../README.md", "projectsDiv", "_parent");

  
  setTimeout(function(){ 
      // Get the levels below root
      var foldercount = (location.pathname.split('/').length - 1); // - (location.pathname[location.pathname.length - 1] == '/' ? 1 : 0) // Removed because ending with slash or filename does not effect levels. Increased -1 to -2.
      foldercount = foldercount - 2;
      var climbcount = foldercount;
      if(location.host.indexOf('localhost') >= 0) {
        climbcount = foldercount - 0;
      }
      var climbpath = "";
      for (var i = 0; i < climbcount; i++) {
        climbpath += "../";
      }

      $(".rootdoc a[href]").each(function() {
        if($(this).attr("href").toLowerCase().indexOf("http") < 0) {
            $(this).attr("href", climbpath + $(this).attr('href'));
        }
      })

    }, 1000);

</script>
<link rel="stylesheet" href="../css/material_icons.css" />
  </body>
</html>