<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>US Goods & Services - Impact</title>
<link rel="icon" type="image/x-icon" href="../../img/logo/favicon.png" />


<style>
body  {
  font-family: Arial, sans-serif;
  font-size: 1em;
  color: steelblue;
  margin:20px;
} 
#table {
    border-collapse: collapse;
}
#th,tr,td{
    padding: 15px;
}
th {
    background-color: steelblue;
    color: white;
    padding: 15px;
    cursor:pointer;
}
tr{
   background-color:#E6F5FF ;
}
</style>

<style>

    /* Wide screen width */
    .rotateHeader {
      margin-right:200px; /* Allows for angle to exceed columns on left. */
      display: block;
    }
    th.rotate {
      heightX: 320px;
      height: 240px;

      white-space: nowrap;
      vertical-align: bottom;
      text-align: left; 
      padding: 2px;
      padding-top:10px;
    }
    th.rotate > div {
      transform: 
        translate(0px, 0px) /* 25px, 51px - To shift right and up. */
        rotate(315deg); /* 45 is really 360 - 45 */
      width: 22px;
      padding: 4px;
      padding-top: 5px;
    }
    th.rotate > div > span {
      padding: 5px 10px;
      font-weight: 400;
      font-size: 13.5px;
      display:block;
      width:230px;
      border-bottomX: 1px solid #dfdfdf;
    }
    th.rotate > div > span:hover {
      background: #eee;
      cursor: pointer;
    }
    .impactTitle {
        padding-top: 34px;
    }
    .th_title {
        width: 50px;
    }
    .th_title > div {
      float:right; /* Allows for space bewteen sections */
    }
    .th_title > div > span, .th_title > div > span:hover {
      border-bottomX: 1px solid #777 !important;
      border-top: 1px solid #333;
      backgroundXXXX: #ddd !important;
      margin-bottomX: 4px;
      cursor: default;
    }
    th.rotate > div > span > span {
        display:none; /* Hide extra after the title */
    }

    /* Wide Screen Width */
    @media (min-width: 1400px) {
      .rotateHeaderHolder {
        margin-right:80px;
      }
    }
    /* Standard Screen Width */
    @media (max-width: 1399px) {
      
      .rotateHeader {
        display:inline;
        overflow: auto;
      }
      th.rotate {
        height: 220px;
      }
      th.rotate > div {
        transform: 
          translate(0px, 0px) /* 25px, 51px - To shift right and up. */
          rotate(270deg); /* 45 is really 360 - 45 */
        width: 20px;
        padding: 0px;
      }
      th.rotate > div > span {
        padding: 5px 10px;
        font-size: 12px;
        width: 200px;
        margin-bottom: 2px;
      }
      .th_title {
          width: 30px;
      }
      .th_title > div > span {
        
        font-size: 14px !important;
        backgroundXXX: #eee;
      }
      .th_title > div > span, .th_title > div > span:hover {
        margin-bottomX: 0px;
      }
    }


    /* Not used */
    #dataList > table > tbody > tr > td:first-child {
      width:300px;
      overflow: hidden;
      white-space: nowrap;
    }

    .heat {
      border: 1px solid #ccc;
      border-rightX: 1px solid #ccc;
      height:20px;
      width:20px;
    }
    .noborderXXX {
      border-left: 1px solid #777 !important;
      border: 0px;
    }
    .noborder spanXXX {
      margin: 0px;
      margin-left: 6px;
      border-left: 1px solid #ddd;
      height: 2px;
    }
    iframe {
      display: block;       /* iframes are inline by default */
      border: none;         /* Reset default border */
      min-height: 85vh;        /* Viewport-relative units */
      width: 100%;
    }
    .oneline {
      overflow:auto;
      height:20px;

    }
  </style>
  

</head>

<body>

<!--
Source: https://bl.ocks.org/luluwuluying/ace3699c70a2e3e7a2bb

To do: Multicolumn sort (but allow for fixed first column)
https://rawgit.com/joequery/Stupid-Table-Plugin/master/examples/multicolumn-sort.html
-->

<h1>US Goods and Services</h1>
<p>
	Sortable CSV Data -
	USEEIOv1.2_result_2007_impacts_final.csv
</p>

<div id="table"></div>

</body>


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js"></script>

<!-- load the function file you need before you call it... -->
<script type="text/javascript" src="stupidtable.js"></script>

<script type="text/javascript">

	//Load in contents of CSV file, and do things to the data.

	d3.csv("USEEIOv1.2_result_2007_impacts_final.csv", function(error, myData) {

		if (error) {
			console.log("Had an error loading file.");
		}

		// We'll be using simpler data as values, not objects.
		var myArray = [];

		// this is a new variable, to make it easier to do a color scale.
		// alternately, you could extract these values with a map function.
		var allDifferences = [];

		myData.forEach(function(d, i){

			// now we add another data object value, a calculated value.
//                    a.Monthlyviews, b.Monthlyvisits
			
			//d.difference = d.Monthlyviews - d.Monthlyvisits;

			d.difference =  d.US_2007_Demand_$;

		 // Add an array to the empty array with the values of each:
	 	 myArray.push([d.Sectors, d.ACID, d.CCDD, d.CMSW, d.CRHW, d.ENRG, d.ETOX, d.EUTR, d.GHG, d.HAPS, d.HCAN, d.HNCN, d.HRSP, d.HTOX, d.JOBS, d.LAND, d.METL, d.MNRL, d.NNRG, d.OZON, d.PEST, d.RNRG, d.SMOG, d.VADD, d.WATR, d.difference]);

 		// this is just a convenience, another way would be to use a function to get the values in the d3 scale.
	 	 allDifferences.push(d.difference);

		});

		console.log(allDifferences);

		var table = d3.select("#table").append("table");

		var header = table.append("thead").append("tr");

		// Made some objects to construct the header in code:
		// The sort_type is for the Jquery sorting function.

		// Minerals and Metals (MINE)
		// Municipal Solid Waste (MSW)
		// Hazardous Waste (HZW)
		// Food Waste (FOOD)

		var headerObjs = [
			{ class: "", column: "Sectors", label: "Sectors", sort_type: "string" },
			{ column: "US_2007_Demand_$", label: "US Demand $ (2007)", sort_type: "int" },
			{ class: "rotate", column: "ACID", label: "Acid Rain", sort_type: "int" },
			{ class: "rotate", column: "CCDD", label: "CCDD", sort_type: "int" },
			{ class: "rotate", column: "CMSW", label: "CMSW", sort_type: "int" },
			{ class: "rotate", column: "CRHW", label: "CRHW", sort_type: "int" },
			{ class: "rotate", column: "ENRG", label: "Energy Use", sort_type: "int" },
			{ class: "rotate", column: "ETOX", label: "Freshwater Ecotoxicity", sort_type: "int" },
			{ class: "rotate", column: "EUTR", label: "Water Eutrophication", sort_type: "int" },
			{ class: "rotate", column: "GHG",  label: "Global Climate Change", sort_type: "int" },
			{ class: "rotate", column: "HAPS", label: "HAPS", sort_type: "int" },
			{ class: "rotate", column: "HCAN", label: "HCAN", sort_type: "int" },
			{ class: "rotate", column: "HNCN", label: "HNCN", sort_type: "int" },
			{ class: "rotate", column: "HRSP", label: "Respiratory Effects", sort_type: "int" },
			{ class: "rotate", column: "HTOX", label: "Toxic to Humans", sort_type: "int" },
			{ class: "rotate", column: "JOBS", label: "Jobs", sort_type: "int" },
			{ class: "rotate", column: "LAND", label: "Land Use", sort_type: "int" },
			{ class: "rotate", column: "METL", label: "METL", sort_type: "int" },
			{ class: "rotate", column: "MNRL", label: "MNRL", sort_type: "int" },
			{ class: "rotate", column: "NNRG", label: "NNRG", sort_type: "int" },
			{ class: "rotate", column: "OZON", label: "Ozone Depletion", sort_type: "int" },
			{ class: "rotate", column: "PEST", label: "PEST", sort_type: "int" },
			{ class: "rotate", column: "RNRG", label: "RNRG", sort_type: "int" },
			{ class: "rotate", column: "SMOG", label: "Smog Formation", sort_type: "int" },
			{ class: "rotate", column: "VADD", label: "Value Added", sort_type: "int" },
			{ class: "rotate", column: "WATR", label: "Water Use", sort_type: "int" },
		];

		header
			.selectAll("th")
			.data(headerObjs)
			.enter()
			.append("th")

			.attr("data-sort", function (d) { return d.sort_type; })
			.attr("class", function (d) { return d.class; })
			.append("div")
  			.text(function(d) { return d.label; });

		var tablebody = table.append("tbody");

		rows = tablebody
			.selectAll("tr")
			.data(myArray)
			.enter()
			.append("tr");

		// We built the rows using the nested array - now each row has its own array.

		// let's talk about the scale - start at 0 or at lowest number?
		console.log('Extent is ', d3.extent(allDifferences));

			var colorScale = d3.scale.linear()
				.domain(d3.extent(allDifferences))
				.range(["#FFC0CB","#C71585"]);

		cells = rows.selectAll("td")
			// each row has data associated; we get it and enter it for the cells.
			.data(function(d) {
				return d;
			})
			.enter()
			.append("td")
			.append("div")
			.style("background-color", function(d,i) {
				// for the last elements in the row, we color the background:
				if (i >= 2) {
					return colorScale(d);
				}
			})
			.text(function(d,i) {
				if (i >= 2) {
					return "";
				} else {
					return d;
				}
			});

// jquery sorting applied to it - could be done with d3 and events.
$("table").stupidtable();

	});

</script>

</html>