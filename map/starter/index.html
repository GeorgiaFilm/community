<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Map Module</title>
<link rel="icon" type="image/x-icon" href="../../img/logo/favicon.png" />

<link rel="stylesheet" href="../../css/community.css" />

<script type="text/javascript" src="../../js/jquery/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../js/common/common.js"></script>
<!--
Activate to include site navigation
<script type="text/javascript" src="../../js/common/navigation.js"></script>

How to support multiple Leaflet maps on the same page? (lodash, not currently using this approach.)
https://groups.google.com/forum/#!topic/leaflet-js/5HBcdTgCuVA
-->

<!--
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
crossorigin=""/>
-->
<link rel="stylesheet" href="../../css/leaflet/leaflet.css" />
 <!-- Resides AFTER Leaflet's CSS -->
<script src="../../js/leaflet/leaflet.js"></script>

<script src="../../js/d3/d3.v5.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="../../css/leaflet/leaflet.icon-material.css" rel="stylesheet">
<script src="../../js/leaflet/leaflet.icon-material.js"></script>
<script src="../../js/d3/d3-legend.js"></script>
<script type="text/javascript" src="../../js/common/dual-map.js"></script>
<link rel="stylesheet" href="../../css/map.css" />
</head>

<body>

<style>
  #allLegends {
    color:#fff !important; 
  }
  #allLegends > .label {
    color:#fff !important; 
  }
</style>

<aside class="Intermodal_Ports">
group,lat,lon,value,address,city,state,zip
Inman Rail Yard,33.795735,-84.439278,NS,1600 Marietta Rd NW,Atlanta,GA,30318
Savannah Yard,32.069578,-81.142174,CSX,3000 Tremont Ave,Savannah,GA,31405
James D. Mason ICTF,32.123934,-81.150914,NS,3 North Main St,Garden City,GA,31408
Fairburn Industry Yard,33.554907,-84.595026,CSX,6700 McLarin Rd,Fairburn,GA,30213
Whitaker Rail Yard,33.80944,-84.655451,NS,6000 Westside Rd,Austell,GA,30106
Chatham ICTF,32.125311,-81.151331,CSX,2 Main St,Garden City,GA,31408
Savannah,32.10035,-81.169963,NS,1 Charlie Gay Drive,Savannah,GA,31408
Cordele Intermodal Center,31.966779,-83.755101,Heart GA,2902 East 13th Ave.,Cordele,GA,31010
Port of Savannah Ocean Terminal,32.093702,-81.111692,"Ro/Ro, Breakbulk",55 N Lathrop Ave,Savannah,GA,31415
Port of Brunswick,31.125887,-81.541194,"Ro/Ro, Agri-Bulk",157 Penniman Cir,Brunswick,GA,31523
Port of Savannah,32.125,-81.151,Container,2 Main St,Savannah,GA,31407
Port of Brunswick Mayor's Point Terminal,31.143373,-81.494753,Breakbulk,1100 Bay Street,Brunswick,GA,31520
Port of Columbus,32.448734,-84.984038,Liquid Bulk,800 Lumpkin Blvd,Columbus,GA,31901
Port of Bainbridge,30.902867,-84.606259,Liquid/Dry Bulk,1321 Spring Creek Road,Bainbridge,GA,39817
</aside>


 <section id="objectives">

    <div class="displayOnload" style="display:none;position:relative;">
      <div id="map"></div>
      <div id="legendHolder">
        <div id="allLegends"></div>
      </div>
    </div>
  </section>
  <div style="clear:both"></div>

<!-- Start HTML -->
  <section id="data" class="litePanel">
    <div class="content displayOnload" style="display:none">
      <div id="flexwrapper">
        <div id="hublist">

          <h1>Data Driven Decision&nbsp;Making</h1>
          <h2 style="font-size: 18px; margin-bottom:0px; font-weight: 600">Smart & Sustainable Movement of <span style="white-space: nowrap">Goods & Services</span></h2><br>
          
            <!--
            <input type="button" onclick="location.href='../../samples/feed';" 
            value="Add your data feeds" style="margin-top:20px; padding:10px" />
            <br><br>
            -->

          <div id="detaillist"></div>
          <div id="narrowlist" style="display:none"></div>
        </div>

        <a name="gomap"></a>
        <div id="mapHolder">
          <div class="mapHolderInner">
            <div class="mapHolderCard card">
              <div id="maptop">
                <div style="position:absolute; left:0; padding:4px 4px 4px 10px">
                  Connected Communities
                </div>
              </div>

              <div style="clear:both">  
                <div id="map2"></div>
              </div>

            </div>
          </div>
        </div>
      
      </div><!-- flexwrapper -->
    </div>  

  </section>
<!-- End HTML -->

    <!--
    To add and update listings, download the <a href="map.csv">map.csv</a> file and edit within a spreadsheet.  
      Copy using a text editor and click the pencil icon <a href="https://github.com/modelearth/community/blob/master/map/map.csv">here</a> to paste into GitHub for review. 
      <span style="white-space: nowrap;">Or you can fork</span> the <a href="https://github.com/modelearth/community">GitHub Repo</a> and commit using <a href="https://desktop.github.com/">GitHub Desktop</a>.
    -->

  <script>
    // INTERMODAL PORTS
    dp = {
      selector: "aside.Intermodal_Ports",
      delimiter: ",",
      numColumns: ["lat","lon"],
      valueColumn: "value",
      scaleType: "scaleOrdinal",
      //scaleType: "scaleQuantile",
      //scaleType: "scaleThreshold",
    }
    //dp.name = dp.selector.split(".").pop(); // name: Intermodal_Ports
    dp.name = "Intermodal Ports"
    dp.data = readData(dp.selector, dp.delimiter, dp.numColumns, dp.valueColumn);
    //dp.color = '#0033ff'; // Alternative to scale
    dp.scale = getScale(dp.data, dp.scaleType, dp.valueColumn);

    dp.group = L.layerGroup();
    //dp.group2 = L.layerGroup();
    //dp.iconName = 'device_hub';
    dp.iconName = 'language';
    //dataParameters.push(dp);
    addIcons(dp);

    // Reactivate once colors differ
    addLegend(dp.scale, dp.scaleType, dp.name);
    var map1 = populateMap('map', dp);
    //basemaps["Rail"].addTo(map1);

    layerControl['map'].addOverlay(baselayers["Rail"], "Railroads"); // Appends to existing layers

    // Test
    //var mapX = loadFromCSV('map', "/community/tools/map.csv");

    // DATA-DRIVEN
    //var map2 = loadFromCSV('map2', "/community/tools/map.csv");
    //var map2 = populateMap('map2', dp);

    loadFromCSV('map2', "/community/tools/map.csv", function(results) {
        // This function gets called by the geocode function on success
        //makeMap(results[0].geometry.location.lat(), results[0].geometry.location.lng());

        layerControl['map2'].addOverlay(baselayers["Rail"], "Railroads"); // Appends to existing layers      
    });
  </script>
</body>

</html>